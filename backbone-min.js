import jQuery from'jquery';import underscore from'underscore';export class Backbone{constructor(){this.VERSION='1.3.3',this.window=window,this.document=document,this.jQuery=jQuery,this.$=jQuery,this.underscore=underscore,this._=underscore,this.emulateHTTP=!1,this.emulateJSON=!1,this.eventSplitter=/\s+/,this.pathStripper=/#.*$/,this.rootStripper=/^\/+|\/+$/g,this.routeStripper=/^[#/]|\s+$/g,this.escapeRegExp=/[-{}[\]+?.,\\^$|#\s]/g,this.namedParam=/(\(\?)?:\w+/g,this.optionalParam=/\((.*?)\)/g,this.splatParam=/\*\w+/g}preinitialize(){}initialize(){}splice(a,b,c){c=Math.min(Math.max(c,0),a.length);const d=Array(a.length-c),e=b.length;let f;for(f=0;f<d.length;f++)d[f]=a[f+c];for(f=0;f<e;f++)a[f+c]=b[f];for(f=0;f<d.length;f++)a[f+e+c]=d[f]}sync(...a){return new Backbone.Sync(a)}ajax(...a){return jQuery.ajax(a)}urlError(){throw new Error('A "url" property or function must be specified')}wrapError(a,b){const c=b.error;b.error=d=>{c&&c.call(b.context,a,d,b),a.trigger('error',a,d,b)}}modelMatcher(a){const b=underscore.matches(a);return a=>b(a.attributes)}cb(a,b){return underscore.isFunction(a)?a:underscore.isObject(a)&&!b._isModel(a)?this.modelMatcher(a):underscore.isString(a)?b=>b.get(a):a}addMethod(a,b,c){return 1===a?()=>underscore[b](this[c]):2===a?a=>underscore[b](this[c],a):3===a?(a,d)=>underscore[b](this[c],this.cb(a,this),d):4===a?(a,d,e)=>underscore[b](this[c],this.cb(a,this),d,e):()=>underscore[b](this.topArgs)}addUnderscoreMethods(a,b,c){underscore.each(b,(b,d)=>{underscore[d]&&(a.prototype[d]=this.addMethod(b,d,c))})}}export class Events extends Backbone{constructor(...a){super(),this.bind=Events.on,this.unbind=Events.off}eventsApi(a,b,c,d,e){let f,g=0;if(c&&'object'==typeof c)for(void 0!==d&&('context'in e)&&void 0===e.context&&(e.context=d),f=Object.keys(c);g<f.length;g++)b=this.eventsApi(a,b,f[g],c[f[g]],e);else if(c&&this.eventSplitter.test(c))for(f=c.split(this.eventSplitter);g<f.length;g++)b=a(b,f[g],d,e);else b=a(b,c,d,e);return b}on(a,b,c){return this.internalOn(this,a,b,c)}internalOn(a,b,c,d,e){if(a._events=this.eventsApi(this.onApi,a._events||{},b,c,{context:d,ctx:a,listening:e}),e){const b=a._listeners||(a._listeners={});b[e.id]=e}return a}listenTo(a,b,c){if(!a)return this;const d=a._listenId||(a._listenId=underscore.uniqueId('l')),e=this._listeningTo||(this._listeningTo={});let f=e[d];if(!f){const b=this._listenId||(this._listenId=underscore.uniqueId('l'));f=e[d]={obj:a,objId:d,id:b,listeningTo:e,count:0}}return this.internalOn(a,b,c,this,f),this}onApi(a,b,c,d){if(c){const e=a[b]||(a[b]=[]),f=d.context,g=d.ctx||f,h=d.listening;h&&h.count++,e.push({callback:c,context:f,ctx:g,listening:h})}return a}off(a,b,c){return this._events?(this._events=this.eventsApi(this.offApi,this._events,a,b,{context:c,listeners:this._listeners}),this):this}stopListening(a,b,c){const d=this._listeningTo;if(!d)return this;const e=a?[a._listenId]:Object.keys(d);for(let f=0;f<e.length;f++){const a=d[e[f]];if(!a)break;a.obj.off(b,c,this)}return this}offApi(a,b,c,d){if(!a)return;let e,f=0;const g=d.context,h=d.listeners;if(!b&&!c&&!g){for(const a=Object.keys(h);f<a.length;f++)e=h[a[f]],delete h[e.id],delete e.listeningTo[e.objId];return}for(const i=b?[b]:Object.keys(a);f<i.length;f++){b=i[f];const d=a[b];if(!d)break;const k=[];for(let a=0;a<d.length;a++){const b=d[a];c&&c!==b.callback&&c!==b.callback._callback||g&&g!==b.context?k.push(b):(e=b.listening,e&&0==--e.count&&(delete h[e.id],delete e.listeningTo[e.objId]))}k.length?a[b]=k:delete a[b]}return a}once(a,b,c){const d=this.eventsApi(this.onceMap,{},a,b,underscore.bind(this.off,this));return'string'==typeof a&&null==c&&(b=void 0),this.on(d,b,c)}listenToOnce(a,b,c){const d=this.eventsApi(this.onceMap,{},b,c,underscore.bind(this.stopListening,this,a));return this.listenTo(a,d)}onceMap(a,b,c,d){if(c){const e=a[b]=underscore.once((...a)=>{d(b,e),c.apply(this,a)});e._callback=c}return a}trigger(a,...b){return this._events?(this.eventsApi(this.triggerApi,this._events,a,void 0,b),this):this}triggerApi(a,b,c,...d){if(a){const c=a[b];let e=a.all;c&&e&&(e=e.slice()),c&&this.triggerEvents(c,d),e&&this.triggerEvents(e,[b].concat(d))}return a}triggerEvents(a,b){let c,d=-1;const e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);}}}export class Model extends Backbone.Events{constructor(a,b,...c){super();let d=a||{};b||(b={}),this.cid=underscore.uniqueId(this.cidPrefix),this.attributes={},b.collection&&(this.collection=b.collection),b.parse&&(d=this.parse(d,b)||{});const e=underscore.result(this,'defaults');d=underscore.defaults(underscore.extend({},e,d),e),this.set(d,b),this.changed=this.attributes.changed||null,this.validationError=this.attributes.changed||null,this.idAttribute=this.attributes.idAttribute||'id',this.cidPrefix=this.attributes.cidPrfix||'c',this.addUnderscoreMethods(Model,this.modelMethods,a),this.initialize.apply(...c)}toJSON(){return underscore.clone(this.attributes)}get(a){return this.attributes[a]}escape(a){return underscore.escape(this.get(a))}has(a){return null!==this.get(a)}matches(a){return!!underscore.iteratee(a,this)(this.attributes)}set(a,b,c){if(null==a)return this;let d;if('object'==typeof a?(d=a,c=b):(d={})[a]=b,c||(c={}),!this._validate(d,c))return!1;const e=c.unset,f=c.silent,g=[],h=this._changing;this._changing=!0,h||(this._previousAttributes=underscore.clone(this.attributes),this.changed={});const j=this.attributes,i=this.changed,k=this._previousAttributes;if(void 0!==d)for(const a in d)b=d[a],underscore.isEqual(j[a],b)||g.push(a),underscore.isEqual(k[a],b)?delete i[a]:i[a]=b,e?delete j[a]:j[a]=b;if(this.idAttribute in d&&(this.id=this.get(this.idAttribute)),!f){g.length&&(this._pending=c);for(let a=0;a<g.length;a++)this.trigger(`change:${g[a]}`,this,j[g[a]],c)}if(h)return this;if(!f)for(;this._pending;)c=this._pending,this._pending=!1,this.trigger('change',this,c);return this._pending=!1,this._changing=!1,this}unset(a,b){return this.set(a,void 0,underscore.extend({},b,{unset:!0}))}clear(a){const b={};if(this.attributes!==void 0)for(const a in this.attributes)b[a]=void 0;return this.set(b,underscore.extend({},a,{unset:!0}))}hasChanged(a){return null==a?!underscore.isEmpty(this.changed):underscore.has(this.changed,a)}changedAttributes(a){if(!a)return!!this.hasChanged()&&underscore.clone(this.changed);const b=this._changing?this._previousAttributes:this.attributes,c={};for(const d in a){const e=a[d];underscore.isEqual(b[d],e)||(c[d]=e)}return!!Object.keys(c).length&&c}previous(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null}previousAttributes(){return underscore.clone(this._previousAttributes)}fetch(a){a=underscore.extend({parse:!0},a);const b=this,c=a.success;return a.success=d=>{const e=a.parse?b.parse(d,a):d;return!!b.set(e,a)&&void(c&&c.call(a.context,b,d,a),b.trigger('sync',b,d,a))},this.wrapError(this,a),this.sync('read',this,a)}save(a,b,c){let d;null==a||'object'==typeof a?(d=a,c=b):(d={})[a]=b,c=underscore.extend({validate:!0,parse:!0},c);const e=c.wait;if(d&&!e){if(!this.set(d,c))return!1;}else if(!this._validate(d,c))return!1;const f=this,g=c.success,h=this.attributes;c.success=a=>{f.attributes=h;let b=c.parse?f.parse(a,c):a;return e&&(b=underscore.extend({},d,b)),(!b||f.set(b,c))&&void(g&&g.call(c.context,f,a,c),f.trigger('sync',f,a,c))},this.wrapError(this,c),d&&e&&(this.attributes=underscore.extend({},h,d));const i=this.isNew()?'create':c.patch?'patch':'update';'patch'!=i||c.attrs||(c.attrs=d);const j=this.sync(i,this,c);return this.attributes=h,j}destroy(a){a=a?underscore.clone(a):{};const b=this,c=a.success,d=a.wait,e=()=>{b.stopListening(),b.trigger('destroy',b,b.collection,a)};a.success=f=>{d&&e(),c&&c.call(a.context,b,f,a),b.isNew()||b.trigger('sync',b,f,a)};let f=!1;return this.isNew()?underscore.defer(a.success):(this.wrapError(this,a),f=this.sync('delete',this,a)),d||e(),f}url(){const a=underscore.result(this,'urlRoot')||underscore.result(this.collection,'url')||this.urlError();if(this.isNew())return a;const b=this.get(this.idAttribute);return a.replace(/[^/]$/,'$&/')+encodeURIComponent(b)}parse(a){return a}clone(){return new this.constructor(this.attributes)}isNew(){return!this.has(this.idAttribute)}isValid(a){return this._validate({},underscore.extend({},a,{validate:!0}))}_validate(a,b){if(!b.validate||!this.validate)return!0;a=underscore.extend({},this.attributes,a);const c=this.validationError=this.validate(a,b)||null;return!c||(this.trigger('invalid',this,c,underscore.extend(b,{validationError:c})),!1)}modelMethods(){return{keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1}}}export class Collection extends Backbone.Model{constructor(a,b,...c){super(),b||(b={}),this.preinitialize.apply(...c),this.model=b.model?b.model:Model,void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(...c),a&&this.reset(a,underscore.extend({silent:!0},b)),this.setOptions={add:!0,remove:!0,merge:!0},this.addOptions={add:!0,remove:!1},this.addUnderscoreMethods(Collection,this.collectionMethods,'models')}toJSON(a){return this.map(b=>b.toJSON(a))}add(a,b){return this.set(a,underscore.extend({merge:!1},b,this.addOptions))}remove(a,b){b=underscore.extend({},b);const c=!underscore.isArray(a);a=c?[a]:a.slice();const d=this._removeModels(a,b);return!b.silent&&d.length&&(b.changes={added:[],merged:[],removed:d},this.trigger('update',this,b)),c?d[0]:d}set(a,b){if(null==a)return;b=underscore.extend({},this.setOptions,b),b.parse&&!this._isModel(a)&&(a=this.parse(a,b)||[]);const c=!underscore.isArray(a);a=c?[a]:a.slice();let d=b.at;null!=d&&(d=+d),d>this.length&&(d=this.length),0>d&&(d+=this.length+1);const e=[],f=[],g=[],h=[],j={},k=b.add,l=b.merge,m=b.remove;let n=!1;const o=this.comparator&&null==d&&!1!==b.sort,p=underscore.isString(this.comparator)?this.comparator:null;let q,r;for(r=0;r<a.length;r++){q=a[r];const c=this.get(q);if(c){if(l&&q!==c){let a=this._isModel(q)?q.attributes:q;b.parse&&(a=c.parse(a,b)),c.set(a,b),g.push(c),o&&!n&&(n=c.hasChanged(p))}j[c.cid]||(j[c.cid]=!0,e.push(c)),a[r]=c}else k&&(q=a[r]=this._prepareModel(q,b),q&&(f.push(q),this._addReference(q,b),j[q.cid]=!0,e.push(q)))}if(m){for(r=0;r<this.length;r++)q=this.models[r],j[q.cid]||h.push(q);h.length&&this._removeModels(h,b)}let s=!1;if(e.length&&!o&&k&&m?(s=this.length!==e.length||this.models.some((a,b)=>a!==e[b]),this.models.length=0,this.splice(this.models,e,0),this.length=this.models.length):f.length&&(o&&(n=!0),this.splice(this.models,f,null==d?this.length:d),this.length=this.models.length),n&&this.sort({silent:!0}),!b.silent){for(r=0;r<f.length;r++)null!=d&&(b.index=d+r),q=f[r],q.trigger('add',q,this,b);(n||s)&&this.trigger('sort',this,b),(f.length||h.length||g.length)&&(b.changes={added:f,removed:h,merged:g},this.trigger('update',this,b))}return c?a[0]:a}reset(a,b){b=b?underscore.clone(b):{};for(let c=0;c<this.models.length;c++)this._removeReference(this.models[c],b);return b.previousModels=this.models,this._reset(),a=this.add(a,underscore.extend({silent:!0},b)),b.silent||this.trigger('reset',this,b),a}push(a,b){return this.add(a,underscore.extend({at:this.length},b))}pop(a){const b=this.at(this.length-1);return this.remove(b,a)}unshift(a,b){return this.add(a,underscore.extend({at:0},b))}shift(a){const b=this.at(0);return this.remove(b,a)}slice(){return Array.prototype.slice(this.models,this.arguments)}get(a){return null==a?void 0:this._byId[a]||this._byId[this.modelId(a.attributes||a)]||a.cid&&this._byId[a.cid]}has(a){return null!=this.get(a)}at(a){return 0>a&&(a+=this.length),this.models[a]}where(a,b){return this[b?'find':'filter'](a)}findWhere(a){return this.where(a,!0)}sort(a){let b=this.comparator;if(!b)throw new Error('Cannot sort a set without a comparator');a||(a={});const c=b.length;return underscore.isFunction(b)&&(b=underscore.bind(b,this)),1===c||underscore.isString(b)?this.models=this.sortBy(b):this.models.sort(b),a.silent||this.trigger('sort',this,a),this}pluck(a){return this.map(`${a}`)}fetch(a){a=underscore.extend({parse:!0},a);const b=a.success,c=this;return a.success=d=>{const e=a.reset?'reset':'set';c[e](d,a),b&&b.call(a.context,c,d,a),c.trigger('sync',c,d,a)},this.wrapError(this,a),this.sync('read',this,a)}create(a,b){b=b?underscore.clone(b):{};const c=b.wait;if(a=this._prepareModel(a,b),!a)return!1;c||this.add(a,b);const d=this,e=b.success;return b.success=(a,b,f)=>{c&&d.add(a,f),e&&e.call(f.context,a,b,f)},a.save(null,b),a}parse(a){return a}clone(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})}modelId(a){return a[this.model.prototype.idAttribute||'id']}_reset(){this.length=0,this.models=[],this._byId={}}_prepareModel(a,b){if(this._isModel(a))return a.collection||(a.collection=this),a;b=b?underscore.clone(b):{},b.collection=this;const c=new this.model(a,b);return c.validationError?(this.trigger('invalid',this,c.validationError,b),!1):c}_removeModels(a,b){const c=[];for(let d=0;d<a.length;d++){const e=this.get(a[d]);if(!e)continue;const f=this.indexOf(e);this.models.this.splice(f,1),this.length--,delete this._byId[e.cid];const g=this.modelId(e.attributes);null!=g&&delete this._byId[g],b.silent||(b.index=f,e.trigger('remove',e,this,b)),c.push(e),this._removeReference(e,b)}return c}_isModel(a){return a instanceof Model}_addReference(a){this._byId[a.cid]=a;const b=this.modelId(a.attributes);null!=b&&(this._byId[b]=a),a.on('all',this._onModelEvent,this)}_removeReference(a){delete this._byId[a.cid];const b=this.modelId(a.attributes);null!=b&&delete this._byId[b],this===a.collection&&delete a.collection,a.off('all',this._onModelEvent,this)}_onModelEvent(a,b,c,d,...e){if(b){if(('add'===a||'remove'===a)&&c!==this)return;if('destroy'===a&&this.remove(b,d),'change'===a){const a=this.modelId(b.previousAttributes()),c=this.modelId(b.attributes);a!==c&&(null!=a&&delete this._byId[a],null!=c&&(this._byId[c]=b))}}this.trigger.apply(e)}collectionMethods(){return{forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3}}}export class View extends Backbone.Events{constructor(a,...b){super(),this.cid=underscore.uniqueId('view'),this.delegateEventSplitter=/^(\S+)\s*(.*)$/,this.tagName='div',this.viewOptions=['model','collection','el','id','attributes','className','tagName','events'],underscore.extend(this,underscore.pick(a,this.viewOptions)),this._ensureElement(),this.initialize.apply(b)}$(a){return this.$el.find(a)}render(){return this}remove(){return this._removeElement(),this.stopListening(),this}_removeElement(){this.$el.remove()}setElement(a){return this.undelegateEvents(),this._setElement(a),this.delegateEvents(),this}_setElement(a){this.$el=a instanceof Backbone.$?a:Backbone.$(a),this.el=this.$el[0]}delegateEvents(a){if(a||(a=underscore.result(this,'events')),void 0!==a)for(const b in this.undelegateEvents(),a){let c=a[b];if(underscore.isFunction(c)||(c=this[c]),!c)continue;const d=b.match(this.delegateEventSplitter);this.delegate(d[1],d[2],underscore.bind(c,this))}return this}delegate(a,b,c){return this.$el.on(`${a}.delegateEvents${this.cid}`,b,c),this}undelegateEvents(){return this.$el&&this.$el.off(`.delegateEvents${this.cid}`),this}undelegate(a,b,c){return this.$el.off(`${a}.delegateEvents${this.cid}`,b,c),this}_createElement(a){return this.document.createElement(a)}_ensureElement(){if(!this.el){const a=underscore.extend({},underscore.result(this,'attributes'));this.id&&(a.id=underscore.result(this,'id')),this.className&&(a.class=underscore.result(this,'className')),this.setElement(this._createElement(underscore.result(this,'tagName'))),this._setAttributes(a)}else this.setElement(underscore.result(this,'el'))}_setAttributes(a){this.$el.attr(a)}}export class Sync extends Backbone{constructor(a,b,c,...d){super();const e=this.methodMap[a];if(underscore.defaults(c||(c={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON}),this.params={type:e,dataType:'json'},c.url||(this.params.url=underscore.result(b,'url')||this.urlError()),null==c.data&&b&&('create'===a||'update'===a||'patch'===a)&&(this.params.contentType='application/json',this.params.data=JSON.stringify(c.attrs||b.toJSON(c))),c.emulateJSON&&(this.params.contentType='application/x-www-form-urlencoded',this.params.data=this.params.data?{model:this.params.data}:{}),c.emulateHTTP&&('PUT'===e||'DELETE'===e||'PATCH'===e)){this.params.type='POST',c.emulateJSON&&(this.params.data._method=e);const a=c.beforeSend;c.beforeSend=b=>{b.setRequestHeader('X-HTTP-Method-Override',e),a&&a.apply()}}return'GET'===this.params.type||c.emulateJSON||(this.params.processData=!1),this.error=(a,b,d)=>{c.textStatus=b,c.errorThrown=d,this.error&&this.error.call(c.context,a,b,d)},this.xhr=c.xhr=Backbone.ajax(underscore.extend(this.params,c)),b.trigger('request',b,this.xhr,c),this.xhr}methodMap(){return{create:'POST',update:'PUT',patch:'PATCH',delete:'DELETE',read:'GET'}}}export class Router extends Backbone.Events{constructor(a,...b){super(),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(b)}route(a,b,c){underscore.isRegExp(a)||(a=this._routeToRegExp(a)),underscore.isFunction(b)&&(c=b,b=''),c||(c=this[b]);const d=this;return Backbone.history.route(a,e=>{const f=d._extractParameters(a,e);!1!==d.execute(c,f,b)&&(d.trigger(...[`route:${b}`].concat(f)),d.trigger('route',b,f),Backbone.history.trigger('route',d,b,f))}),this}execute(a,b){a&&a.apply(this,b)}navigate(a,b){return Backbone.history.navigate(a,b),this}_bindRoutes(){if(!this.routes)return;this.routes=underscore.result(this,'routes');let a;for(const b=Object.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}_routeToRegExp(a){return a=a.replace(this.escapeRegExp,'\\$&').replace(this.optionalParam,'(?:$1)?').replace(this.namedParam,(a,b)=>b?a:'([^/?]+)').replace(this.splatParam,'([^?]*?)'),new RegExp(`^${a}(?:\\?([\\s\\S]*))?$`)}_extractParameters(a,b){return this.params=a.exec(b).slice(1),this.params.map((a,b)=>b===this.params.length-1?a||null:a?decodeURIComponent(a):null)}}export class History extends Backbone.Events{constructor(...a){super(),this.interval=new Map(...a).get('interval')||20,this.handlers=[],this.checkUrl=underscore.bind(this.checkUrl,this),'undefined'!=typeof this.window&&(this.location=this.window.location,this.history=this.window.history),this.started=!1}atRoot(){const a=this.location.pathname.replace(/[^/]$/,'$&/');return a===this.root&&!this.getSearch()}matchRoot(){const a=this.decodeFragment(this.location.pathname),b=`${a.slice(0,this.root.length-1)}/`;return b===this.root}decodeFragment(a){return decodeURI(a.replace(/%25/g,'%2525'))}getSearch(){const a=this.location.href.replace(/#.*/,'').match(/\?.+/);return a?a[0]:''}getHash(a){const b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:''}getPath(){const a=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return'/'===a.charAt(0)?a.slice(1):a}getFragment(a){return null==a&&(this._usePushState||!this._wantsHashChange?a=this.getPath():a=this.getHash()),a.replace(this.routeStripper,'')}start(a){if(History.started)throw new Error('Backbone.history has already been started');if(History.started=!0,this.options=underscore.extend({root:'/'},this.options,a),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._hasHashChange='onhashchange'in window&&(void 0===document.documentMode||7<this.document.documentMode),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.history&&this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=`/${this.root}/`.replace(this.rootStripper,'/'),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){const a=this.root.slice(0,-1)||'/';return this.location.replace(`${a}#${this.getPath()}`),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=this.document.createElement('iframe'),this.iframe.src=void 0,this.iframe.style.display='none',this.iframe.tabIndex=-1;const a=this.document.body,b=a.insertBefore(this.iframe,a.firstChild).contentWindow;b.document.open(),b.document.close(),b.location.hash=`#${this.fragment}`}const b=this.window.addEventListener||function(a,b){return this.window.attachEvent(`on${a}`,b)};if(this._usePushState?b('popstate',this.checkUrl,!1):this._useHashChange&&!this.iframe?b('hashchange',this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),!this.options.silent)return this.loadUrl()}stop(){const a=this.window.removeEventListener||function(a,b){return this.detachEvent(`on${a}`,b)};this._usePushState?a('popstate',this.checkUrl,!1):this._useHashChange&&!this.iframe&&a('hashchange',this.checkUrl,!1),this.iframe&&(this.document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),History.started=!1}route(a,b){this.handlers.unshift({route:a,callback:b})}checkUrl(){let a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getHash(this.iframe.contentWindow)),a!==this.fragment&&void(this.iframe&&this.navigate(a),this.loadUrl())}loadUrl(a){return!!this.matchRoot()&&(a=this.fragment=this.getFragment(a),this.handlers.some(b=>!!b.route.test(a)&&(b.callback(a),!0)))}navigate(a,b){if(!History.started)return!1;b&&!0!==b||(b={trigger:!!b}),a=this.getFragment(a||'');let c=this.root;(''===a||'?'===a.charAt(0))&&(c=c.slice(0,-1)||'/');const d=c+a;if(a=this.decodeFragment(a.replace(this.pathStripper,'')),this.fragment!==a){if(this.fragment=a,this._usePushState)this.history[b.replace?'replaceState':'pushState']({},this.document.title,d);else{if(!this._wantsHashChange)return this.location.assign(d);if(this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getHash(this.iframe.contentWindow)){const c=this.iframe.contentWindow;b.replace||(c.document.open(),c.document.close()),this._updateHash(c.location,a,b.replace)}}return b.trigger?this.loadUrl(a):void 0}}_updateHash(a,b,c){if(c){const c=a.href.replace(/(javascript:|#).*$/,'');a.replace(`${c}#${b}`)}else a.hash=`#${b}`}}

//# sourceMappingURL=backbone-min.js.map